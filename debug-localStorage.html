<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug localStorage - Asset Manager Data</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .debug-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: #f9f9f9;
        }
        .json-display {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .button {
            background: #2196f3;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .button:hover {
            background: #1976d2;
        }
        .success { color: #4caf50; font-weight: bold; }
        .error { color: #f44336; font-weight: bold; }
        .warning { color: #ff9800; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç localStorage Debug - Asset Manager Data</h1>
        
        <div class="debug-section">
            <h3>Current localStorage Contents</h3>
            <button class="button" onclick="checkLocalStorage()">üîç Check localStorage</button>
            <button class="button" onclick="clearAllData()">üóëÔ∏è Clear All Data</button>
            <button class="button" onclick="reloadTestData()">üîÑ Reload Test Data</button>
            <div id="localStorage-status"></div>
        </div>
        
        <div class="debug-section">
            <h3>savedMeetings Data</h3>
            <div id="meetings-data" class="json-display">Click "Check localStorage" to view data</div>
        </div>
        
        <div class="debug-section">
            <h3>Expected vs Actual Data Analysis</h3>
            <div id="data-analysis"></div>
        </div>
        
        <div class="debug-section">
            <h3>Actions</h3>
            <button class="button" onclick="navigateToApp()">üöÄ Go to Asset Manager Dashboard</button>
            <button class="button" onclick="forceReactReload()">üîÑ Force React App Reload</button>
        </div>
    </div>

    <script>
        function checkLocalStorage() {
            const statusDiv = document.getElementById('localStorage-status');
            const meetingsDiv = document.getElementById('meetings-data');
            const analysisDiv = document.getElementById('data-analysis');
            
            try {
                // Check all localStorage keys
                const allKeys = Object.keys(localStorage);
                statusDiv.innerHTML = `
                    <p><strong>All localStorage keys:</strong> ${allKeys.join(', ')}</p>
                `;
                
                // Check savedMeetings specifically
                const savedMeetings = localStorage.getItem('savedMeetings');
                if (savedMeetings) {
                    const meetings = JSON.parse(savedMeetings);
                    meetingsDiv.textContent = JSON.stringify(meetings, null, 2);
                    
                    // Analyze the data
                    let analysis = `<p class="success">‚úÖ savedMeetings found with ${meetings.length} meetings</p>`;
                    
                    let totalLTIs = 0;
                    let sixMonthsPlus = 0;
                    
                    meetings.forEach((meeting, index) => {
                        analysis += `<p><strong>Meeting ${index + 1}:</strong> ${meeting.name || meeting.id}</p>`;
                        
                        if (meeting.isolations) {
                            analysis += `<p>  - Isolations: ${meeting.isolations.length}</p>`;
                            totalLTIs += meeting.isolations.length;
                            
                            meeting.isolations.forEach(isolation => {
                                const plannedDate = isolation['Planned Start Date'] || isolation.plannedStartDate;
                                if (plannedDate) {
                                    const startDate = new Date(plannedDate);
                                    const currentDate = new Date();
                                    const diffTime = Math.abs(currentDate - startDate);
                                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                                    
                                    if (diffDays >= 183) { // 6 months
                                        sixMonthsPlus++;
                                    }
                                    
                                    analysis += `<p>    - ${isolation.id}: ${diffDays} days old (${plannedDate})</p>`;
                                }
                            });
                        } else {
                            analysis += `<p class="warning">  - ‚ö†Ô∏è No isolations array found</p>`;
                        }
                        
                        if (meeting.responses) {
                            analysis += `<p>  - Responses: ${Object.keys(meeting.responses).length}</p>`;
                        } else {
                            analysis += `<p class="warning">  - ‚ö†Ô∏è No responses object found</p>`;
                        }
                    });
                    
                    analysis += `<hr>`;
                    analysis += `<p><strong>CALCULATED METRICS:</strong></p>`;
                    analysis += `<p>üìä Total LTIs: ${totalLTIs}</p>`;
                    analysis += `<p>üìä LTIs Over 6 Months: ${sixMonthsPlus}</p>`;
                    
                    analysisDiv.innerHTML = analysis;
                } else {
                    meetingsDiv.textContent = 'No savedMeetings data found in localStorage';
                    analysisDiv.innerHTML = '<p class="error">‚ùå No savedMeetings data found</p>';
                }
                
            } catch (error) {
                statusDiv.innerHTML = `<p class="error">‚ùå Error: ${error.message}</p>`;
                meetingsDiv.textContent = 'Error reading localStorage';
                analysisDiv.innerHTML = `<p class="error">‚ùå Error analyzing data: ${error.message}</p>`;
            }
        }
        
        function clearAllData() {
            if (confirm('Are you sure you want to clear all localStorage data?')) {
                localStorage.clear();
                document.getElementById('localStorage-status').innerHTML = '<p class="success">‚úÖ All localStorage data cleared</p>';
                document.getElementById('meetings-data').textContent = 'Data cleared';
                document.getElementById('data-analysis').innerHTML = '<p>Data cleared - reload test data to continue</p>';
            }
        }
        
        function reloadTestData() {
            try {
                // Clear existing data
                localStorage.clear();
                
                // Create the same test data structure as in load-corrected-test-data.html
                const meetingsWithProperStructure = [
                    {
                        id: 'meeting-001',
                        name: 'LTI OMT Meeting - June 2023',
                        date: '2023-06-15',
                        attendees: ['Asset Manager', 'OMT Team', 'Operations Manager'],
                        isolations: [
                            {
                                id: 'CAHE-001-OLD',
                                description: 'Heat Exchanger Long-term Isolation',
                                'System/Equipment': 'CAHE-001-HX-001',
                                'Planned Start Date': '2023-06-01',
                                'Risk Level': 'High',
                                'MOC Required': 'Yes',
                                'Equipment Issues': 'Yes'
                            },
                            {
                                id: 'CAHE-002-OLD',
                                description: 'Pump Isolation - Extended',
                                'System/Equipment': 'CAHE-002-P-001',
                                'Planned Start Date': '2023-07-15',
                                'Risk Level': 'Medium',
                                'MOC Required': 'Yes',
                                'Equipment Issues': 'No'
                            }
                        ],
                        responses: {
                            'CAHE-001-OLD': {
                                riskLevel: 'High',
                                mocRequired: 'Yes',
                                mocStatus: 'In Progress',
                                mocNumber: 'MOC-2023-001',
                                actionRequired: 'Plan Work',
                                equipmentDisconnectionRequired: 'Yes',
                                equipmentRemovalRequired: 'No',
                                corrosionRisk: 'High',
                                deadLegsRisk: 'Medium',
                                automationLossRisk: 'Low',
                                comments: 'Critical long-term isolation requiring Asset Manager review'
                            },
                            'CAHE-002-OLD': {
                                riskLevel: 'Medium',
                                mocRequired: 'Yes',
                                mocStatus: 'Completed',
                                mocNumber: 'MOC-2023-002',
                                actionRequired: 'Monitor',
                                equipmentDisconnectionRequired: 'No',
                                equipmentRemovalRequired: 'No',
                                corrosionRisk: 'Low',
                                deadLegsRisk: 'Low',
                                automationLossRisk: 'Medium',
                                comments: 'Well-managed long-term isolation'
                            }
                        }
                    },
                    {
                        id: 'meeting-002',
                        name: 'LTI OMT Meeting - January 2023',
                        date: '2023-01-20',
                        attendees: ['Asset Manager', 'OMT Team', 'Safety Manager'],
                        isolations: [
                            {
                                id: 'CAHE-003-VERY-OLD',
                                description: 'Critical Valve Isolation',
                                'System/Equipment': 'CAHE-003-V-001',
                                'Planned Start Date': '2022-12-01',
                                'Risk Level': 'High',
                                'MOC Required': 'Yes',
                                'Equipment Issues': 'Yes'
                            },
                            {
                                id: 'CAHE-004-OLD',
                                description: 'Piping Section Isolation',
                                'System/Equipment': 'CAHE-004-P-002',
                                'Planned Start Date': '2023-01-20',
                                'Risk Level': 'Medium',
                                'MOC Required': 'No',
                                'Equipment Issues': 'Yes'
                            }
                        ],
                        responses: {
                            'CAHE-003-VERY-OLD': {
                                riskLevel: 'High',
                                mocRequired: 'Yes',
                                mocStatus: 'Required',
                                actionRequired: 'Urgent',
                                equipmentDisconnectionRequired: 'Yes',
                                equipmentRemovalRequired: 'Yes',
                                corrosionRisk: 'High',
                                deadLegsRisk: 'High',
                                automationLossRisk: 'High',
                                comments: 'CRITICAL: This isolation has been active for over 2 years and requires immediate Asset Manager attention'
                            },
                            'CAHE-004-OLD': {
                                riskLevel: 'Medium',
                                mocRequired: 'No',
                                actionRequired: 'Plan Work',
                                equipmentDisconnectionRequired: 'No',
                                equipmentRemovalRequired: 'Yes',
                                corrosionRisk: 'Medium',
                                deadLegsRisk: 'Low',
                                automationLossRisk: 'Low',
                                comments: 'Planned equipment removal will resolve this long-term isolation'
                            }
                        }
                    },
                    {
                        id: 'meeting-003',
                        name: 'LTI OMT Meeting - March 2024',
                        date: '2024-03-10',
                        attendees: ['Asset Manager', 'OMT Team'],
                        isolations: [
                            {
                                id: 'CAHE-005-MEDIUM',
                                description: 'Instrument Isolation',
                                'System/Equipment': 'CAHE-005-I-001',
                                'Planned Start Date': '2024-03-01',
                                'Risk Level': 'Low',
                                'MOC Required': 'Yes',
                                'Equipment Issues': 'No'
                            },
                            {
                                id: 'CAHE-007-BORDERLINE',
                                description: 'Compressor Isolation',
                                'System/Equipment': 'CAHE-007-C-001',
                                'Planned Start Date': '2024-07-01',
                                'Risk Level': 'Medium',
                                'MOC Required': 'Yes',
                                'Equipment Issues': 'Yes'
                            },
                            {
                                id: 'CAHE-006-RECENT',
                                description: 'New Valve Isolation',
                                'System/Equipment': 'CAHE-006-V-002',
                                'Planned Start Date': '2024-11-01',
                                'Risk Level': 'Low',
                                'MOC Required': 'No',
                                'Equipment Issues': 'No'
                            }
                        ],
                        responses: {
                            'CAHE-005-MEDIUM': {
                                riskLevel: 'Low',
                                mocRequired: 'Yes',
                                mocStatus: 'Submitted',
                                mocNumber: 'MOC-2024-005',
                                actionRequired: 'Monitor',
                                equipmentDisconnectionRequired: 'No',
                                equipmentRemovalRequired: 'No',
                                corrosionRisk: 'Low',
                                deadLegsRisk: 'Medium',
                                automationLossRisk: 'Low',
                                comments: 'Well-managed isolation approaching 1 year'
                            },
                            'CAHE-007-BORDERLINE': {
                                riskLevel: 'Medium',
                                mocRequired: 'Yes',
                                mocStatus: 'Required',
                                actionRequired: 'Plan Work',
                                equipmentDisconnectionRequired: 'Yes',
                                equipmentRemovalRequired: 'No',
                                corrosionRisk: 'Medium',
                                deadLegsRisk: 'Low',
                                automationLossRisk: 'Medium',
                                comments: 'Borderline 6-month isolation requiring Asset Manager review'
                            },
                            'CAHE-006-RECENT': {
                                riskLevel: 'Low',
                                mocRequired: 'No',
                                actionRequired: 'Monitor',
                                equipmentDisconnectionRequired: 'No',
                                equipmentRemovalRequired: 'No',
                                corrosionRisk: 'Low',
                                deadLegsRisk: 'Low',
                                automationLossRisk: 'Low',
                                comments: 'Recent isolation, no immediate concerns'
                            }
                        }
                    }
                ];
                
                // Save to localStorage
                localStorage.setItem('savedMeetings', JSON.stringify(meetingsWithProperStructure));
                
                document.getElementById('localStorage-status').innerHTML = '<p class="success">‚úÖ Test data reloaded successfully!</p>';
                
                // Automatically check the data
                setTimeout(checkLocalStorage, 500);
                
            } catch (error) {
                document.getElementById('localStorage-status').innerHTML = `<p class="error">‚ùå Error reloading test data: ${error.message}</p>`;
            }
        }
        
        function navigateToApp() {
            window.open('http://localhost:3000/asset-manager-dashboard', '_blank');
        }
        
        function forceReactReload() {
            // This will trigger a hard refresh of the React app
            const newWindow = window.open('http://localhost:3000/asset-manager-dashboard', '_blank');
            setTimeout(() => {
                if (newWindow) {
                    newWindow.location.reload(true);
                }
            }, 1000);
        }
        
        // Auto-check localStorage on page load
        window.onload = function() {
            checkLocalStorage();
        };
    </script>
</body>
</html>
